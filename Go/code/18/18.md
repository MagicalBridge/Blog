# 第 18 天

## 1.下面三个函数分别返回什么？

```go
func f1() (r int) {
  defer func() {
    r++
  }()
  return 0
}

func f2() (r int) {
  t := 5
  defer func() {
    t = t + 5
  }()
  return t
}

func f3() (r int) {
  defer func(r int) {
    r = r + 5
  }(r)
  return 1
}
```


## 解析：

这三个函数的返回值分别是：
```
f1(): 1
f2(): 5
f3(): 1
```

1. `f1()` 返回 1 的原因：
   - 函数使用了命名返回值 `r`
   - `return 0` 会先将 0 赋值给 `r`
   - defer 函数中的 `r++` 会在返回前执行，直接修改返回值 `r`
   - 所以最终返回值为 1（0+1）

2. `f2()` 返回 5 的原因：
   - 函数声明了局部变量 `t = 5`
   - `return t` 会将 t 的值（5）赋给返回值 `r`
   - defer 函数虽然修改了 `t` 的值（t = t + 5 = 10），但这不会影响已经赋值给 `r` 的值
   - 所以最终返回值为 5

3. `f3()` 返回 1 的原因：
   - 函数使用了命名返回值 `r`
   - defer 函数接收一个参数 `r`，这个 `r` 是一个新的局部变量，与外部的命名返回值 `r` 不是同一个变量
   - `return 1` 会将 1 赋值给返回值 `r`
   - defer 函数中的 `r = r + 5` 只修改了函数参数 `r`，不会影响外部的返回值 `r`
   - 所以最终返回值为 1

关键点总结：
1. 命名返回值可以被 defer 函数直接修改
2. defer 函数对局部变量的修改不会影响已经赋值的返回值
3. defer 函数的参数会在声明时被拷贝，而不是在执行时求值
4. defer 函数的参数如果与外部变量同名，则会遮蔽外部变量